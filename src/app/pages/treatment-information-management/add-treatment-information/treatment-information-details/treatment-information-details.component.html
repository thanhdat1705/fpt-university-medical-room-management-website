<!-- <nz-table #colSpanTable [nzScroll]="{ x: '1000px' }" [nzData]="listOfData" nzBordered (nzCurrentPageDataChange)="onCurrentPageDataChange($event)"> -->



<div class="search-filter" *ngIf="treatmentDetailsForm">
  <nz-input-group nzSearch nzSize="large" [nzAddOnAfter]="searchIconButton">
    <input class="input" placeholder="Nhập tên dược phẩm" nz-input [(ngModel)]="searchNameValue" />
  </nz-input-group>
  <ng-template #searchIconButton>
    <button nz-button nzType="primary" nzSize="large" nzSearch class="iconButton" (click)="searchMedicineName()">
      <i nz-icon nzType="search" nzTheme="outline"></i>
    </button>
  </ng-template>
  <br><br>
  <div class="select-wrap">
    <span style="font-weight: 500; margin-right: 10px;">Bộ lọc tím kiếm:</span>
    <!--   <nz-select class="select-w" nzPlaceHolder="Đơn vị" nzAllowClear [(ngModel)]="unitValue"
            (ngModelChange)="onSearchUnit($event)" [ngClass]="{'ant-select-selection': unitSelected}">
            <nz-option *ngFor="let option of filterUnit" [nzLabel]="option.name" [nzValue]="option.id"></nz-option>
        </nz-select>-->
    <nz-select class="select-w" nzPlaceHolder="Phân loại" nzAllowClear [(ngModel)]="filterClassificationValue"
      (ngModelChange)="onSearchClassification()" (nzScrollToBottom)="loadMoreClassification()"
      [nzDropdownRender]="renderTemplate">
      <nz-option *ngFor="let option of medicineClassificationList" [nzLabel]="option.name" [nzValue]="option.id">
      </nz-option>
    </nz-select>
    <ng-template #renderTemplate>
      <nz-spin *ngIf="isLoading"></nz-spin>
    </ng-template>
    <nz-select class="select-w" nzPlaceHolder="Nhóm" nzAllowClear [(ngModel)]="filterSubgroupValue"
      (ngModelChange)="onSearchSubGroup()" (nzScrollToBottom)="loadMoreSubGroup()"
      [nzDropdownRender]="renderTemplate">
      <nz-option *ngFor="let option of medicineSubGroupList" [nzLabel]="option.name" [nzValue]="option.id">
      </nz-option>
    </nz-select>
    <ng-template #renderTemplate>
      <nz-spin *ngIf="isLoading"></nz-spin>
    </ng-template>
  </div>
</div>

<nz-table style="overflow-y: hidden" *ngIf="treatmentDetailsTableData" [nzData]="medicineInInventoryList"
  [nzPageSize]="pageSize" [nzScroll]="{ x: '200px', y: '280px' }" [nzPageIndex]="pageIndex" [nzTotal]="total"
  [nzFrontPagination]="false" (nzQueryParams)="onQueryParamsChange($event)">

  <thead>
    <tr>
      <th nzWidth="60px"></th>
      <th nzWidth="150px">Thuốc</th>
      <th nzWidth="120px">Số lượng</th>
      <th nzWidth="140px">Ngày hết hạn</th>
    </tr>
  </thead>
  <tbody>
    <ng-container *ngFor="let data of treatmentDetailsTableData">
      <tr>
        <td [nzExpand]="expandSet.has(data.medicineInInventory.medicine.id)"
          (nzExpandChange)="onExpandChange(data.medicineInInventory.medicine.id, $event)"></td>
        <td> {{ data.medicineInInventory.medicine.name }} </td>
        <td>{{ data.medicineInInventory.quantity }} {{ data.medicineInInventory.medicine.medicineUnit.name }}</td>
        <td></td>
      </tr>
      <ng-container *ngFor="let item of data.medicineInInventoryDetails">
        <tr [nzExpand]="expandSet.has(data.medicineInInventory.medicine.id)">

          <td [nzChecked]="setOfCheckedId.has(item.id)" (nzCheckedChange)="onItemChecked(item.id, $event)"></td>
          <td style="padding-left: 30px; width: 35%;">
            {{item.name}}
          </td>
          <td style=" width: 30%">
            <!-- Bug ko insert dc xuong list   -->
            <!-- <nz-input-number [nzMin]="0" [nzMax]="item.quantity" [nzStep]="1"  style=" margin-left: 80px; width: 35%;" nz-input #inputValue
            (keyup)="createTreatmentDetails(item.id, inputValue.value, data.medicineInInventory.medicineId, data.medicineInInventory.name, data.medicineInInventory.medicineUnit.name, generalService.getDate(item.expirationDate ))" [nzDisabled]="!setOfCheckedId.has(item.id)"
            (keydown)="createTreatmentDetails(item.id, inputValue.value, data.medicineInInventory.medicineId, data.medicineInInventory.name, data.medicineInInventory.medicineUnit.name, generalService.getDate(item.expirationDate ))"
            (input)="createTreatmentDetails(item.id, inputValue.value, data.medicineInInventory.medicineId, data.medicineInInventory.name, data.medicineInInventory.medicineUnit.name, generalService.getDate(item.expirationDate ))"
            value="!setOfCheckedId.has(item.id) ? 0 : getTreatmentDetailsQuantity(item.id)"></nz-input-number> -->
            <!-- <form [formGroup]="treatmentDetailsForm">
              <nz-form-item style="margin-bottom: 0px;">
                <nz-form-control> -->
            <input [nzErrorTip]="quantityTpl" [nzMax]="item.quantity" style=" margin-left: 10px;width: 35%;" nz-input
              #inputValue type="number" nz-input-number [nzMin]="0" [nzMax]="item.quantity"
              (input)="createTreatmentDetails(item.id, inputValue.value, data.medicineInInventory.medicine.id, data.medicineInInventory.medicine.name, data.medicineInInventory.medicine.medicineUnit.name, generalService.getDate(item.expirationDate ),item.quantity)"
              [disabled]="!setOfCheckedId.has(item.id)"
              [value]="!setOfCheckedId.has(item.id) ? item.quantity : getTreatmentDetailsQuantity(item.id)" />
            <span *ngIf="setOfCheckedId.has(item.id)"> /{{item.quantity}}</span>
            <!-- <ng-template #quantityTpl let-control>
                    <ng-container *ngIf="f.quantity.hasError('required')">
                      <span> {{ generalService.showRequiredError("Số lượng") }}
                      </span>
                    </ng-container>
                    <ng-container *ngIf="f.quantity.hasError('min') || f.quantity.hasError('max')">
                      Số lượng phải lớn hơn 0 và nhỏ hơn
                      {{eliminatedMedicineDetails.medicineInInventoryDetail.quantity}}
                      {{eliminatedMedicineDetails.medicineUnit.name}} hiện có
                    </ng-container>
                    <ng-container *ngIf="f.quantity.hasError('pattern')">
                      <span>{{ generalService.showNumberPatternError("Số lượng") }}</span>
                    </ng-container>
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </form> -->

          </td>
          <td>{{ generalService.getDate(item.expirationDate )}}</td>
        </tr>

      </ng-container>
      <!-- <ng-container *ngFor="let item of data.medicines">
        <tr [nzExpand]="expandSet.has(data.id)">
          <th  [nzChecked]="setOfCheckedId.has(item.id)" (nzCheckedChange)="onItemChecked(item.id, $event)"></th>
          <td>
            {{ item.name }}
          </td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.expiredDay }}</td>
        </tr>
      </ng-container> -->
    </ng-container>
  </tbody>

</nz-table>
<div *nzModalFooter>
  <button nz-button nzType="default" (click)="destroyModal()">Hủy</button>

  <button nz-button nzType="primary" (click)="sendRequest()">Lưu</button>

</div>